{% load django_bootstrap5 %}

<head hx-head="merge">
    <title>{{ site_info_model.brand_name }} | Settings</title>
</head>

<div class="container" x-data='{selected: 1}'>
    <div class="m-2 mt-3 p-3">
        <div class="text-white">
            <header class="fs-3">Settings</header>
            <p class="fs-5">
                Here you can modify a variety of settings pertaining to the application.
            </p>
        </div>
    </div>
    <div class='d-flex flex-wrap justify-content-center gap-1 mb-0'>
        <button class='btn btn-sm selection-button' @click='selected = 1'
                :class="{'btn-primary': selected == 1, 'btn-secondary': selected != 1}"
        >
            General
        </button>
        <button class='btn btn-sm selection-button' @click='selected = 2'
                :class="{'btn-primary': selected == 2, 'btn-secondary': selected != 2}"
        >
            SEO
        </button>
        <button class='btn btn-sm selection-button' @click='selected = 3'
                :class="{'btn-primary': selected == 3, 'btn-secondary': selected != 3}"
        >
            Auth
        </button>
        <button class='btn btn-sm selection-button' @click='selected = 4'
                :class="{'btn-primary': selected == 4, 'btn-secondary': selected != 4}"
        >
            Game Servers
        </button>
        <button class='btn btn-sm selection-button' @click='selected = 5'
                :class="{'btn-primary': selected == 5, 'btn-secondary': selected != 5}"
        >
            Discord Bot
        </button>
        <button class='btn btn-sm selection-button' @click='selected = 6'
                :class="{'btn-primary': selected == 6, 'btn-secondary': selected != 6}"
        >
            Donations
        </button>
        <button class='btn btn-sm selection-button' @click='selected = 7'
                :class="{'btn-primary': selected == 7, 'btn-secondary': selected != 7}"
        >
            Colors
        </button>
        <button class='btn btn-sm selection-button' @click='selected = 8'
                :class="{'btn-primary': selected == 8, 'btn-secondary': selected != 8}"
        >
            Images
        </button>
        <button class='btn btn-sm selection-button' @click='selected = 9'
                :class="{'btn-primary': selected == 9, 'btn-secondary': selected != 9}"
        >
            Default Pages
        </button>
    </div>
    <form class="form"
          enctype="multipart/form-data" 
          hx-post="{% url 'panel:settings'%}"
          hx-include="#imageConfigInput"
          hx-swap='none'
    >
        <div x-show='selected == 1' class="m-3">
            <div class="card bg-dark p-2">
                <div class="card-body">
                    <div class="m-3 mt-1 p-1">
                        <div class="text-white">
                            <header class="fs-5">General Settings</header>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center text-white">
                        <div class="w-50">
                            {% csrf_token %} 
                            {% bootstrap_field SettingsInformation.brand_name %}
                            {% bootstrap_field SettingsInformation.contact_email %}
                            {% bootstrap_field SettingsInformation.enable_footer %}
                            {% bootstrap_field SettingsInformation.enable_footer_contact %}
                            {% bootstrap_field SettingsInformation.enable_footer_credit %}
                            {% bootstrap_field SettingsInformation.navigation_from_top %}
                            {% bootstrap_button button_type="submit" content="Update" %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div x-show='selected == 2' class="m-3">
            <div class="card bg-dark p-2">
                <div class="card-body">
                    <div class="m-3 mt-1 p-1">
                        <div class="text-white">
                            <header class="fs-5">SEO</header>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center text-white">
                        <div class="w-50">
                            {% bootstrap_field SettingsInformation.meta_description %}
                            {% bootstrap_field SettingsInformation.meta_keywords %}
                            {% bootstrap_button button_type="submit" content="Update" %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div x-show='selected == 3' class="m-3">
            <div class="card bg-dark p-2">
                <div class="card-body">
                    <div class="m-3 mt-1 p-1">
                        <div class="text-white">
                            <header class="fs-5">Auth</header>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center text-white">
                        <div class="w-50">
                            {% bootstrap_field SettingsInformation.require_login_for_user_list %}
                            {% bootstrap_button button_type="submit" content="Update" %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div x-show='selected == 4' class="m-3">
            <div class="card bg-dark p-2">
                <div class="card-body">
                    <div class="m-3 mt-1 p-1">
                        <div class="text-white">
                            <header class="fs-5">Game Servers</header>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center text-white">
                        <div class="w-50">  
                                {% bootstrap_field SettingsInformation.enable_server_query %}
                                {% bootstrap_field SettingsInformation.query_delay %}
                                {% bootstrap_field SettingsInformation.server_pagination_count %}
                                {% bootstrap_field SettingsInformation.collapse_network_rules_when_accessing_server_rules %}
                                {% bootstrap_field SettingsInformation.server_online_message %}
                                {% bootstrap_field SettingsInformation.server_offline_message %}
                                {% bootstrap_field SettingsInformation.server_maintenance_message %}
                                {% bootstrap_button button_type="submit" content="Update" %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div x-show='selected == 5' class="m-3">
            <div class="card bg-dark p-2">
                <div class="card-body">
                    <div class="m-3 mt-1 p-1">
                        <div class="text-white">
                            <header class="fs-5">Discord Bot</header>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center text-white">
                        <div class="w-50">
                            {% bootstrap_field SettingsInformation.discord_guild %}
                            {% bootstrap_field SettingsInformation.discord_global_announcement_channel %}
                            {% bootstrap_field SettingsInformation.discord_staff_role %}
                            {% bootstrap_button button_type="submit" content="Update" %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div x-show='selected == 6' class="m-3">
            <div class="card bg-dark p-2">
                <div class="card-body">
                    <div class="m-3 mt-1 p-1">
                        <div class="text-white">
                            <header class="fs-5">Donations</header>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center text-white">
                        <div class="w-50">
                            {% bootstrap_field SettingsInformation.stripe_enabled %}
                            {% bootstrap_field SettingsInformation.paypal_enabled %}
                            {% bootstrap_field SettingsInformation.donation_currency %}
                            {% bootstrap_field SettingsInformation.donation_goal %}
                            {% bootstrap_field SettingsInformation.show_donation_goal %}
                            {% bootstrap_field SettingsInformation.show_recent_donators %}
                            {% bootstrap_field SettingsInformation.send_donation_email %}
                            {% bootstrap_button button_type="submit" content="Update" %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div x-show='selected == 7' class="m-3">
            <div class="card bg-dark p-2">
                <div class="card-body">
                    <div class="m-3 mt-1 p-1">
                        <div class="text-white">
                            <header class="fs-5">Colors</header>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center text-white">
                        <div class="w-50">
                            {% bootstrap_field SettingsInformation.main_color %}
                            {% bootstrap_field SettingsInformation.use_main_color %}
                            {% bootstrap_field SettingsInformation.secondary_color %}
                            {% bootstrap_field SettingsInformation.use_secondary_color %}
                            {% bootstrap_button button_type="submit" content="Update" %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>
    <div x-show='selected == 8' class="m-3">
        <div class="card bg-dark p-2">
            <div class="card-body">
                <div class="m-3 mt-1 p-1">
                    <div class="text-white">
                        <header class="fs-5">Images</header>
                    </div>
                </div>
                <div class="d-flex justify-content-center text-white">
                    <div class="w-50">
                        <div id='imageConfigInput' class="form-check form-switch mb-3 mt-3">
                            <input type="checkbox" type="submit" name="use_svg_brand"
                                   {%if site_information.use_svg_brand%}checked=""{%endif%}
                                   class="form-check-input is-valid" id="id_use_svg_brand" onclick='switchBrandField()'>
                            <label class="form-check-label" for="id_use_svg_brand">Use SVG Branding Image</label>
                            <div class="form-text text-white">If this is checked, the SVG Branding Image will be used instead of the uploaded raster Branding Image.</div>
                        </div>
                        <form class="form"
                            enctype="multipart/form-data" 
                            hx-post="{% url 'panel:settings_files_update'%}"
                            hx-swap='none'
                        > 
                            {% csrf_token %}
                            <div id='branding_image_field_box'>
                                {% bootstrap_field SettingsInformationFiles.branding_image %}
                            </div>
                            <div id='branding_image_svg_field_box' style='display: none'>
                                {% bootstrap_field SettingsInformationFiles.branding_image_svg %}
                            </div>
                            {% bootstrap_field SettingsInformationFiles.background_image %}
                            {% bootstrap_field SettingsInformationFiles.avatar_image %}
                            {% bootstrap_button button_type="submit" content="Update" %}

                        </form>
                        <hr>
                        <p class="fs-5 text-center">
                            Current Files
                        </p>
                        <div class="d-flex justify-content-center text-white">
                            {% if site_information.use_svg_brand %}
                            <img class="m-3 w-25"
                                 src="{% if site_information.branding_image_svg %}{{ site_information.branding_image_svg.url }}{% endif %}"
                                 alt="No Brand Image - SVG"
                                 data-bs-toggle="tooltip"
                                 data-bs-html="true"
                                 data-bs-title="Brand Image - SVG">
                            {% else %}
                            <img class="m-3 w-25"
                                 src="{% if site_information.branding_image %}{{ site_information.branding_image.url }}{% endif %}"
                                 alt="No Brand Image"
                                 data-bs-toggle="tooltip"
                                 data-bs-html="true"
                                 data-bs-title="Brand Image">
                            {% endif %}

                            <img class="m-3 w-25"
                                 src="{% if site_information.background_image %}{{ site_information.background_image.url }}{% endif %}"
                                 alt="No Background Image"
                                 data-bs-toggle="tooltip"
                                 data-bs-html="true"
                                 data-bs-title="Background Image">

                            <img class="m-3 w-25"
                                 src="{% if site_information.avatar_image %}{{ site_information.avatar_image.url }}{% endif %}"
                                 alt="No Avatar Image"
                                 data-bs-toggle="tooltip"
                                 data-bs-html="true"
                                 data-bs-title="Avatar Image">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div x-show='selected == 9' class="m-3">
        <div class="card bg-dark p-2">
            <div class="card-body">
                <div class="m-3 mt-1 p-1">
                    <div class="text-white">
                        <header class="fs-5">Default Pages</header>
                    </div>
                </div>
                <div class="d-flex justify-content-center text-white">
                    <div class="w-50">
                        <form class="form"
                            enctype="multipart/form-data" 
                            hx-post="{% url 'panel:settings_default_pages'%}"
                            hx-swap='none'
                        > 
                            {% csrf_token %}  
                            {% bootstrap_form SettingsDefaultPages %}
                            {% bootstrap_button button_type="submit" content="Update" %}

                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    try {
        tooltipTriggerList
    } catch (error) {
        const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
        const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
    }
</script>

<script>
    $(document).ready(function () {
        {% if site_information.use_svg_brand %}
            document.getElementById('branding_image_field_box').style.display = 'none'
            document.getElementById('branding_image_svg_field_box').style.display = 'block'
        {% endif %}
    });
    
    function switchBrandField() {
        if (document.getElementById('branding_image_svg_field_box').style.display === 'none') {
            document.getElementById('branding_image_field_box').style.display = 'none'
            document.getElementById('branding_image_svg_field_box').style.display = 'block'
        }

        else {
            document.getElementById('branding_image_field_box').style.display = 'block'
            document.getElementById('branding_image_svg_field_box').style.display = 'none'
        }
      
      }
</script>
